function computePointsFromDice(mode, fortuneKey, allDiceCounts){
  const notes = [];
  const d = {...allDiceCounts};

  const skullsTotal = d.skull;
  const bust = skullsTotal >= 3;
  const pirateMultiplier = (fortuneKey === 'pirate') ? 2 : 1;

  if (bust){
    // Si la carta es "botín", computamos sólo los dados guardados (sin bonificaciones)
    if (fortuneKey === 'chest') {
      const faceValue = (d.gold + d.diamond) * 100;
      const setTypes = [
        { key: 'monkey', n: d.monkey },
        { key: 'parrot', n: d.parrot }
      ];
      let setScore = 0;
      for (const t of setTypes) {
        if (t.n >= 3) {
          setScore += SET_POINTS[t.n] || 0;
        }
      }
      const points = faceValue + setScore;
      notes.push('Muerte con botín: puntos calculados sólo de los dados guardados.');
      return {
        points,
        fullChestBonus: 0,
        shipBonusOrPenalty: 0,
        pirateMultiplier,
        bust: true,
        notes
      };
    }
    return {
      points: 0,
      fullChestBonus: 0,
      shipBonusOrPenalty: 0,
      pirateMultiplier,
      bust: true,
      notes: ['3+ calaveras: el turno normal puntúa 0.']
    };
  }

  // Cálculo estándar de puntos si no hay muerte.
  let faceValue = (d.gold + d.diamond) * 100;

  const setTypes = [];
  if (fortuneKey === 'animals'){
    const animals = d.monkey + d.parrot;
    setTypes.push({ key:'animals', n: animals });
    notes.push('Carta Animales: monos+loros combinan en un único set.');
  } else {
    setTypes.push({ key:'monkey', n: d.monkey });
    setTypes.push({ key:'parrot', n: d.parrot });
  }
  setTypes.push({ key:'saber', n: d.saber });
  setTypes.push({ key:'gold', n: d.gold });
  setTypes.push({ key:'diamond', n: d.diamond });

  let setScore = 0;
  for (const t of setTypes){
    if (t.n >= 3){
      setScore += SET_POINTS[t.n] || 0;
    }
  }

  let shipBonusOrPenalty = 0;
  let fullChestBonus = 0;
  const anyPoints = (faceValue + setScore + Math.max(0, shipBonusOrPenalty)) > 0;
  if (d.skull === 0 && anyPoints){
    fullChestBonus = 500;
    notes.push('Cofre completo: +500.');
  }

  let points = (faceValue + setScore + fullChestBonus + shipBonusOrPenalty) * pirateMultiplier;

  if ((fortuneKey === 'skull1' || fortuneKey === 'skull2') && fullChestBonus > 0){
    points -= fullChestBonus * pirateMultiplier;
    fullChestBonus = 0;
    notes.push('Carta Calavera: no hay bono de cofre completo.');
  }

  return { points, fullChestBonus, shipBonusOrPenalty, pirateMultiplier, bust:false, notes };
}